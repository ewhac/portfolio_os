/***************************************************************\
*								*
* File:  atan2f16.c						*
*								*
* Opera math routines						*
*								*
* By:  Stephen H. Landrum					*
*								*
* Last update:  9-Apr-93					*
*								*
* Copyright (c) 1992, 1993, The 3DO Company                     *
* All rights reserved						*
* This program is proprietary and confidential			*
*								*
\***************************************************************/

#include "mathfolio.h"

#define DBUG(x)  /* printf x */

static ufrac16 atantable[] = {
  0x00000000, 0x000028be, 0x0000517c, 0x00007a39, 0x0000a2f6, 0x0000cbb1, 0x0000f46a, 0x00011d22,
  0x000145d7, 0x00016e8a, 0x0001973a, 0x0001bfe7, 0x0001e890, 0x00021136, 0x000239d7, 0x00026274,
  0x00028b0d, 0x0002b3a0, 0x0002dc2e, 0x000304b6, 0x00032d38, 0x000355b4, 0x00037e29, 0x0003a698,
  0x0003ceff, 0x0003f75f, 0x00041fb7, 0x00044806, 0x0004704e, 0x0004988c, 0x0004c0c2, 0x0004e8ef,
  0x00051111, 0x0005392a, 0x00056139, 0x0005893d, 0x0005b137, 0x0005d925, 0x00060109, 0x000628e0,
  0x000650ac, 0x0006786c, 0x0006a01f, 0x0006c7c6, 0x0006ef5f, 0x000716ec, 0x00073e6b, 0x000765dc,
  0x00078d3f, 0x0007b494, 0x0007dbdb, 0x00080312, 0x00082a3b, 0x00085154, 0x0008785e, 0x00089f59,
  0x0008c643, 0x0008ed1d, 0x000913e6, 0x00093a9f, 0x00096147, 0x000987dd, 0x0009ae62, 0x0009d4d6,
  0x0009fb38, 0x000a2188, 0x000a47c5, 0x000a6df0, 0x000a9409, 0x000aba0e, 0x000ae000, 0x000b05df,
  0x000b2bab, 0x000b5163, 0x000b7707, 0x000b9c97, 0x000bc213, 0x000be77a, 0x000c0ccd, 0x000c320b,
  0x000c5734, 0x000c7c47, 0x000ca146, 0x000cc62f, 0x000ceb02, 0x000d0fc0, 0x000d3468, 0x000d58f9,
  0x000d7d75, 0x000da1d9, 0x000dc628, 0x000dea60, 0x000e0e80, 0x000e328a, 0x000e567d, 0x000e7a58,
  0x000e9e1d, 0x000ec1c9, 0x000ee55e, 0x000f08dc, 0x000f2c41, 0x000f4f8f, 0x000f72c4, 0x000f95e1,
  0x000fb8e6, 0x000fdbd3, 0x000ffea7, 0x00102163, 0x00104406, 0x00106690, 0x00108901, 0x0010ab59,
  0x0010cd98, 0x0010efbe, 0x001111cb, 0x001133bf, 0x00115599, 0x0011775a, 0x00119902, 0x0011ba8f,
  0x0011dc04, 0x0011fd5e, 0x00121e9f, 0x00123fc6, 0x001260d3, 0x001281c7, 0x0012a2a0, 0x0012c35f,
  0x0012e405, 0x00130490, 0x00132501, 0x00134558, 0x00136595, 0x001385b7, 0x0013a5c0, 0x0013c5ae,
  0x0013e582, 0x0014053b, 0x001424da, 0x0014445f, 0x001463c9, 0x00148319, 0x0014a24e, 0x0014c169,
  0x0014e06a, 0x0014ff50, 0x00151e1c, 0x00153ccd, 0x00155b64, 0x001579e0, 0x00159842, 0x0015b689,
  0x0015d4b6, 0x0015f2c9, 0x001610c1, 0x00162e9e, 0x00164c62, 0x00166a0a, 0x00168799, 0x0016a50d,
  0x0016c266, 0x0016dfa6, 0x0016fccb, 0x001719d6, 0x001736c6, 0x0017539c, 0x00177058, 0x00178cfa,
  0x0017a982, 0x0017c5ef, 0x0017e243, 0x0017fe7c, 0x00181a9b, 0x001836a1, 0x0018528c, 0x00186e5e,
  0x00188a15, 0x0018a5b3, 0x0018c137, 0x0018dca1, 0x0018f7f2, 0x00191329, 0x00192e46, 0x0019494a,
  0x00196434, 0x00197f05, 0x001999bc, 0x0019b45a, 0x0019cedf, 0x0019e94a, 0x001a039c, 0x001a1dd5,
  0x001a37f5, 0x001a51fc, 0x001a6bea, 0x001a85bf, 0x001a9f7b, 0x001ab91f, 0x001ad2a9, 0x001aec1b,
  0x001b0575, 0x001b1eb6, 0x001b37de, 0x001b50ee, 0x001b69e5, 0x001b82c5, 0x001b9b8c, 0x001bb43b,
  0x001bccd1, 0x001be550, 0x001bfdb7, 0x001c1606, 0x001c2e3d, 0x001c465c, 0x001c5e64, 0x001c7654,
  0x001c8e2d, 0x001ca5ee, 0x001cbd98, 0x001cd52a, 0x001ceca5, 0x001d0409, 0x001d1b56, 0x001d328c,
  0x001d49ab, 0x001d60b3, 0x001d77a4, 0x001d8e7f, 0x001da542, 0x001dbbf0, 0x001dd287, 0x001de907,
  0x001dff71, 0x001e15c5, 0x001e2c02, 0x001e422a, 0x001e583b, 0x001e6e37, 0x001e841d, 0x001e99ec,
  0x001eafa7, 0x001ec54b, 0x001edada, 0x001ef054, 0x001f05b8, 0x001f1b06, 0x001f3040, 0x001f4564,
  0x001f5a73, 0x001f6f6e, 0x001f8453, 0x001f9923, 0x001faddf, 0x001fc286, 0x001fd718, 0x001feb96,
  0x00200000, 0x00200000,
};


frac16
Atan2F16 (frac16 x, frac16 y)
{
  uint32 i, j, q, n, r;
  ufrac16 tmp;

  if (x==0 && y==0) return 0;
  
  q = 0;
  n = 0;

  if (y<0) {
    q = 4;
    x = -x;
    y = -y;
  }
  if (x<0) {
    q ^= 3;
    n = 1;
    x = -x;
  }
  if (x<y) {
    q ^= 1;
    n ^= 1;
    tmp = x;
    x = y;
    y = tmp;
  }

  tmp = DivUF16 (y, x);
  i = tmp>>8;
  j = tmp&0xff;
  DBUG (("x/y = %lx.%04lx  i,j = %lx,%lx\n", tmp>>16, tmp&0xffff, i, j));
  
  r = atantable[i]*(256-j)+atantable[i+1]*j;
  r >>= 8;
  if (n) r = 0x00200000 - r;
  r += q*0x00200000;
  return r;
}



